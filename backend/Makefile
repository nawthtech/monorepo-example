# Makefile for NawthTech Backend

.PHONY: help build run test clean deps migrate

# Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
help:
	@echo "Ø£ÙˆØ§Ù…Ø± NawthTech Backend Ø§Ù„Ù…ØªØ§Ø­Ø©:"
	@echo ""
	@echo "  build     - Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
	@echo "  run       - ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„ØªØ·ÙˆÙŠØ±)"
	@echo "  test      - ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"
	@echo "  clean     - ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ©"
	@echo "  deps      - ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª"
	@echo "  migrate   - ØªØ´ØºÙŠÙ„ ØªØ±Ø­ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
	@echo "  docker    - Ø¨Ù†Ø§Ø¡ ØµÙˆØ±Ø© Docker"
	@echo ""

# Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
build:
	@echo "ğŸ—ï¸  Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù†ÙˆØ° ØªÙƒ..."
	go build -o bin/nawthtech main.go

# ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„ØªØ·ÙˆÙŠØ±)
run:
	@echo "ğŸš€ ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… Ø§Ù„ØªØ·ÙˆÙŠØ±..."
	go run main.go server --env development

# Email Management
setup-email:
	@echo "ğŸš€ Setting up email routing..."
	@go run cmd/email-setup/main.go -action=setup

test-email:
	@if [ -z "$(email)" ]; then \
		echo "âŒ Usage: make test-email email=test@example.com"; \
		exit 1; \
	fi
	@go run cmd/email-setup/main.go -action=test -email=$(email)

add-email:
	@if [ -z "$(email)" ]; then \
		echo "âŒ Usage: make add-email email=user@example.com"; \
		exit 1; \
	fi
	@go run cmd/email-setup/main.go -action=add-email -email=$(email)

list-emails:
	@go run cmd/email-setup/main.go -action=list

# Run all setup
setup-all: setup-email
	@echo "âœ… All services configured"

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
test:
	@echo "ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª..."
	go test -v ./...

# ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ©
clean:
	@echo "ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ©..."
	rm -rf bin/
	rm -rf coverage.txt

# ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª
deps:
	@echo "ğŸ“¦ ØªØ­Ø¯ÙŠØ« Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª Go..."
	go mod tidy
	go mod download

# ØªØ±Ø­ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
migrate:
	@echo "ğŸ—„ï¸  ØªØ´ØºÙŠÙ„ ØªØ±Ø­ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."
	go run main.go migrate --direction up

# Ø¨Ù†Ø§Ø¡ ØµÙˆØ±Ø© Docker
docker:
	@echo "ğŸ³ Ø¨Ù†Ø§Ø¡ ØµÙˆØ±Ø© Docker..."
	docker build -t nawthtech/backend:latest .

# ÙØ­Øµ Ø§Ù„ØµØ­Ø©
health:
	@echo "ğŸ” ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù…..."
	go run main.go health

# Ø¹Ø±Ø¶ Ø§Ù„Ø¥ØµØ¯Ø§Ø±
version:
	@echo "ğŸ“‹ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø±..."
	go run main.go version

# Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
fmt:
	@echo "ğŸ¨ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯..."
	go fmt ./...

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
vet:
	@echo "ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯..."
	go vet ./...